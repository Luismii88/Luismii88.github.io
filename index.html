<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NutriApp</title>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:-apple-system;background:#0b1220;color:white;}
.hidden{display:none;}
.container{padding:20px;}
.card{background:#111827;padding:20px;border-radius:20px;margin-bottom:20px;}
button{width:100%;padding:12px;border:none;border-radius:12px;margin-top:8px;background:#22c55e;color:white;font-weight:600;}
button.secondary{background:#374151;}
.topnav{display:flex;background:#0b1220;border-bottom:1px solid #1f2937;}
.topnav button{flex:1;background:none;color:#9ca3af;}
.topnav button.active{color:#22c55e;font-weight:700;}
select,textarea{width:100%;margin-top:8px;padding:8px;border-radius:8px;border:none;}
.meal-block{margin-top:10px;padding:10px;background:#1f2937;border-radius:10px;}
.meal-title{font-weight:700;margin-bottom:5px;}
</style>
</head>
<body>

<div id="loginScreen" class="container">
<div class="card">
<h2>NutriApp</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Contraseña">
<button id="loginBtn">Entrar</button>
<button id="googleBtn" class="secondary">Entrar con Google</button>
<p id="loginError" style="color:red;"></p>
</div>
</div>

<div id="app" class="hidden">

<div class="topnav">
<button id="tabHome" class="active">Home</button>
<button id="tabEditar">Editar</button>
<button id="logoutBtn">Salir</button>
</div>

<div id="home" class="container">
<div id="planVisual"></div>
</div>

<div id="editar" class="container hidden">
<div class="card">
<select id="personaSelect">
<option value="Luismi">Luismi</option>
<option value="Natalia">Natalia</option>
</select>
<select id="diaSelect"></select>
<div id="editorComidas"></div>
<button onclick="guardarCambios()">Guardar Cambios</button>
</div>
</div>

</div>

<script>

// FIREBASE
const firebaseConfig={
apiKey:"AIzaSyCaQq-aQ5kj2TdvccyejdjNTcZvViKIncY",
authDomain:"nutriapp-2eeb3.firebaseapp.com",
projectId:"nutriapp-2eeb3"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

// DIAS
const dias=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"];
dias.forEach(d=>diaSelect.innerHTML+=`<option>${d}</option>`);

// PLAN COMPLETO
let planSemanal={
Luismi:{
Lunes:{
Desayuno:["250 g queso fresco batido","80 g avena","30 g whey","15 g crema cacahuete","1 plátano"],
Media:["30 g whey"],
Comida:["220 g pechuga pollo","100 g arroz crudo","250 g verduras","10 g AOVE"],
Merienda:["200 g yogur griego","15 g nueces"],
Cena:["200 g salmón","300 g calabacín","200 g patata"]
},
Martes:{
Desayuno:["Igual lunes"],
Comida:["220 g ternera","400 g patata","250 g espinaca"],
Cena:["3 huevos","200 g claras","250 g verduras","150 g queso fresco","60 g pan"]
},
Miércoles:{
Desayuno:["Igual lunes"],
Comida:["220 g pavo","100 g couscous crudo","250 g verduras"],
Cena:["220 g carne picada 5%","2 pitas integrales","200 g verduras","30 g tomate"]
},
Jueves:{
Desayuno:["Igual lunes"],
Comida:["220 g salmón","90 g arroz crudo","250 g verduras"],
Cena:["400 ml crema calabacín","200 g pollo","60 g pan"]
},
Viernes:{
Desayuno:["Igual lunes"],
Comida:["90 g lenteja cruda","180 g pollo","250 g verduras"],
Cena:["220 g pescado blanco","300 g patata","250 g verduras"]
},
Sábado:{
Desayuno:["Igual lunes"],
Comida:["250 g carne","350 g boniato","250 g verduras"],
Cena:["3 huevos","200 g gambas","250 g espárragos","60 g pan"]
},
Domingo:{
Desayuno:["Igual lunes"],
Comida:["110 g arroz","3 huevos","200 g gambas","250 g verduras"],
Cena:["400 ml crema","200 g pavo","pan si entrenaste"]
}
},
Natalia:{
Lunes:{
Desayuno:["60 g avena","200 ml leche sin lactosa","20 g whey","15 g nueces","½ plátano"],
Comida:["130 g pollo","70 g arroz crudo","200 g verduras","10 g AOVE"],
Cena:["140 g salmón","250 g calabacín","150 g patata"]
},
Martes:{
Desayuno:["Igual lunes"],
Comida:["120 g ternera","300 g patata","200 g espinaca"],
Cena:["2 huevos","150 g claras","200 g calabacín","100 g queso fresco"]
},
Miércoles:{
Desayuno:["Igual lunes"],
Comida:["130 g pavo","70 g couscous crudo","200 g verduras"],
Cena:["120 g carne picada","1 pita integral","150 g verduras","20 g tomate"]
},
Jueves:{
Desayuno:["Igual lunes"],
Comida:["140 g salmón","60 g arroz crudo","200 g verduras"],
Cena:["350 ml crema calabacín","120 g pollo"]
},
Viernes:{
Desayuno:["Igual lunes"],
Comida:["60 g lenteja cruda","100 g pollo","200 g verduras"],
Cena:["140 g dorada/lubina","200 g patata","200 g verduras"]
},
Sábado:{
Desayuno:["Igual lunes"],
Comida:["130 g carne","250 g boniato","200 g verduras"],
Cena:["2 huevos","120 g gambas","200 g espárragos"]
},
Domingo:{
Desayuno:["Igual lunes"],
Comida:["70 g arroz","2 huevos","120 g gambas","200 g verduras"],
Cena:["350 ml crema","120 g pavo"]
}
}
};

// AUTH
auth.onAuthStateChanged(user=>{
if(user){
loginScreen.classList.add("hidden");
app.classList.remove("hidden");
renderHome();
}else{
loginScreen.classList.remove("hidden");
app.classList.add("hidden");
}
});

loginBtn.onclick=()=>auth.signInWithEmailAndPassword(email.value,password.value).catch(e=>loginError.innerText=e.message);
googleBtn.onclick=async()=>{
const provider=new firebase.auth.GoogleAuthProvider();
await auth.signInWithPopup(provider);
};
logoutBtn.onclick=()=>auth.signOut();

// VISUALIZAR
function renderHome(){
let html="";
for(let persona in planSemanal){
html+=`<h3>${persona}</h3>`;
for(let dia in planSemanal[persona]){
html+=`<div class="card"><b>${dia}</b>`;
for(let comida in planSemanal[persona][dia]){
html+=`<div class="meal-block"><div class="meal-title">${comida}</div>${planSemanal[persona][dia][comida].join("<br>")}</div>`;
}
html+="</div>";
}
}
planVisual.innerHTML=html;
}

// EDITOR
personaSelect.onchange=renderEditor;
diaSelect.onchange=renderEditor;

function renderEditor(){
const p=personaSelect.value;
const d=diaSelect.value;
if(!planSemanal[p][d]) return;
let html="";
for(let comida in planSemanal[p][d]){
html+=`<div class="meal-block"><div class="meal-title">${comida}</div>
<textarea id="edit_${comida}">${planSemanal[p][d][comida].join("\n")}</textarea>
</div>`;
}
editorComidas.innerHTML=html;
}

function guardarCambios(){
const p=personaSelect.value;
const d=diaSelect.value;
for(let comida in planSemanal[p][d]){
let texto=document.getElementById("edit_"+comida).value;
planSemanal[p][d][comida]=texto.split("\n");
}
renderHome();
alert("Guardado");
}

// NAV
function activar(tab){
document.querySelectorAll(".topnav button").forEach(b=>b.classList.remove("active"));
home.classList.add("hidden");
editar.classList.add("hidden");
if(tab==="home"){tabHome.classList.add("active");home.classList.remove("hidden");}
if(tab==="editar"){tabEditar.classList.add("active");editar.classList.remove("hidden");}
}
tabHome.onclick=()=>activar("home");
tabEditar.onclick=()=>activar("editar");

</script>

</body>
</html>
