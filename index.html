<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0b1220">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>NutriApp</title>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:-apple-system;background:#0b1220;color:white;}
.hidden{display:none;}
.container{padding:20px;}
.card{background:#111827;padding:20px;border-radius:20px;margin-bottom:20px;}
button{width:100%;padding:14px;border:none;border-radius:14px;margin-top:10px;background:#22c55e;color:white;font-weight:600;}
button.secondary{background:#374151;}
.topnav{display:flex;background:#0b1220;border-bottom:1px solid #1f2937;}
.topnav button{flex:1;background:none;color:#9ca3af;}
.topnav button.active{color:#22c55e;font-weight:700;}
input,select,textarea{width:100%;margin-top:8px;padding:10px;border-radius:10px;border:none;}
table{width:100%;border-collapse:collapse;font-size:12px;}
th,td{border:1px solid #1f2937;padding:6px;}
.compra-item{display:flex;justify-content:space-between;margin:6px 0;}
.dashboard{background:#1f2937;padding:12px;border-radius:14px;margin-bottom:15px;}
</style>
</head>
<body>

<div id="loginScreen" class="container">
<div class="card">
<h2>NutriApp</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Contrase√±a">
<button id="loginBtn">Entrar</button>
<button id="googleBtn" class="secondary">Entrar con Google</button>
<p id="loginError" style="color:red;"></p>
</div>
</div>

<div id="app" class="hidden">

<div class="topnav">
<button id="tabHome" class="active">Home</button>
<button id="tabCompra">Compra</button>
<button id="logoutBtn">Salir</button>
</div>

<div id="home" class="container">
<div class="dashboard" id="dashboard"></div>
<div id="tablaPlan"></div>
</div>

<div id="compra" class="container hidden">
<div class="card">
<h3>Compra autom√°tica</h3>
<div id="listaAuto"></div>
<h3 style="margin-top:20px;">Extras</h3>
<div id="listaExtras"></div>
<input type="text" id="nuevoExtra" placeholder="A√±adir extra">
<button onclick="addExtra()">A√±adir</button>
</div>
</div>

</div>

<script>

// FIREBASE
const firebaseConfig={
apiKey:"AIzaSyCaQq-aQ5kj2TdvccyejdjNTcZvViKIncY",
authDomain:"nutriapp-2eeb3.firebaseapp.com",
projectId:"nutriapp-2eeb3"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

// BASE NUTRICIONAL (prote√≠na por 100g)
const macros={
"pollo":22,
"pavo":22,
"salm√≥n":20,
"ternera":21,
"carne":21,
"carne picada":20,
"gambas":20,
"arroz":2.5,
"avena":13,
"lenteja":24,
"huevo":6,
"claras":11,
"whey":80,
"queso fresco":8,
"yogur":10
};

// PLAN BASE SIMPLIFICADO (estructura autom√°tica)
const planBase={
Luismi:{
Lunes:[["pollo",220],["arroz",100],["salm√≥n",200]],
Martes:[["ternera",220],["huevo",3],["claras",200]],
Mi√©rcoles:[["pavo",220],["carne picada",220]],
Jueves:[["salm√≥n",220],["pollo",200]],
Viernes:[["lenteja",90],["pollo",180]],
S√°bado:[["carne",250],["gambas",200]],
Domingo:[["arroz",110],["huevo",3],["gambas",200]]
},
Natalia:{
Lunes:[["pollo",130],["arroz",70],["salm√≥n",140]],
Martes:[["ternera",120],["huevo",2],["claras",150]],
Mi√©rcoles:[["pavo",130],["carne picada",120]],
Jueves:[["salm√≥n",140],["pollo",120]],
Viernes:[["lenteja",60],["pollo",100]],
S√°bado:[["carne",130],["gambas",120]],
Domingo:[["arroz",70],["huevo",2],["gambas",120]]
}
};

// AUTH
auth.onAuthStateChanged(user=>{
if(user){
loginScreen.classList.add("hidden");
app.classList.remove("hidden");
renderApp();
}else{
loginScreen.classList.remove("hidden");
app.classList.add("hidden");
}
});

loginBtn.onclick=()=>auth.signInWithEmailAndPassword(email.value,password.value).catch(e=>loginError.innerText=e.message);
googleBtn.onclick=async()=>{
const provider=new firebase.auth.GoogleAuthProvider();
await auth.signInWithPopup(provider);
};
logoutBtn.onclick=()=>auth.signOut();

// DASHBOARD
function calcularProteina(persona){
let total=0;
for(let dia in planBase[persona]){
planBase[persona][dia].forEach(item=>{
const nombre=item[0];
const gramos=item[1];
if(macros[nombre]){
if(nombre==="huevo"){
total+=gramos*macros[nombre];
}else{
total+= (gramos/100)*macros[nombre];
}
}
});
}
return Math.round(total/7);
}

function renderDashboard(){
dashboard.innerHTML=`
üë® Luismi ‚Üí ${calcularProteina("Luismi")}g prote√≠na/d√≠a<br>
üë©‚Äçü¶∞ Natalia ‚Üí ${calcularProteina("Natalia")}g prote√≠na/d√≠a
`;
}

// TABLA
function renderTabla(){
let html="<table><tr><th>D√≠a</th><th>Luismi</th><th>Natalia</th></tr>";
for(let dia in planBase.Luismi){
html+=`<tr><td>${dia}</td><td>${planBase.Luismi[dia].map(i=>i[0]+" "+i[1]+"g").join("<br>")}</td><td>${planBase.Natalia[dia].map(i=>i[0]+" "+i[1]+"g").join("<br>")}</td></tr>`;
}
html+="</table>";
tablaPlan.innerHTML=html;
}

// COMPRA AUTOM√ÅTICA
function generarCompra(){
let suma={};
["Luismi","Natalia"].forEach(p=>{
for(let dia in planBase[p]){
planBase[p][dia].forEach(i=>{
suma[i[0]]=(suma[i[0]]||0)+i[1];
});
}
});
let html="";
for(let item in suma){
html+=`<div class="compra-item"><span>${item}</span><span>${Math.round(suma[item]/1000*100)/100} kg</span></div>`;
}
listaAuto.innerHTML=html;
}

// EXTRAS
async function addExtra(){
const texto=nuevoExtra.value;
if(!texto) return;
await db.collection("extras").doc(texto).set({nombre:texto});
nuevoExtra.value="";
renderExtras();
}

async function renderExtras(){
listaExtras.innerHTML="";
const snap=await db.collection("extras").get();
snap.forEach(doc=>{
listaExtras.innerHTML+=`<div class="compra-item">${doc.id}</div>`;
});
}

// NAV
function activar(tab){
document.querySelectorAll(".topnav button").forEach(b=>b.classList.remove("active"));
home.classList.add("hidden");
compra.classList.add("hidden");
if(tab==="home"){tabHome.classList.add("active");home.classList.remove("hidden");}
if(tab==="compra"){tabCompra.classList.add("active");compra.classList.remove("hidden");}
}
tabHome.onclick=()=>activar("home");
tabCompra.onclick=()=>activar("compra");

function renderApp(){
renderDashboard();
renderTabla();
generarCompra();
renderExtras();
}

</script>

</body>
</html>
